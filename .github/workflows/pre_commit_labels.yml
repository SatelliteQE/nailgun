name: add cherry-pick version labels to pre-commit-ci pr's

on:
  pull_request_target:
    types:
      - opened
      - ready_for_review
      - reopened
      - synchronize

jobs:
  add-labels:
    runs-on: ubuntu-latest
    if: github.actor == 'pre-commit-bot'
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Read labels from YAML
        id: read-labels
        run: |
          LABELS=$(python3 -c "import yaml; print(' '.join(yaml.safe_load(open('./.github/labels.yaml'))['supported-branch-labels']))")
          echo "LABELS=$LABELS" >> "$GITHUB_OUTPUT"

      - name: apply cherry-pick version labels.
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.CHERRYPICK_PAT }}
          script: |
            const labels = '${{ steps.read-labels.outputs.LABELS }}';
            const prNumber = '${{ github.event.number }}';
            github.rest.issues.addLabels({
              issue_number: prNumber,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: labels.split(' ')
            }); 
